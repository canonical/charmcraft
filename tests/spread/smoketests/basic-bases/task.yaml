summary: pack a simple charm with a 'bases' key.

environment:
  BASE_NAME: ubuntu
  BASE_CHANNEL/focal: 20.04
  BASE_CHANNEL/jammy: 22.04
  BASE_CHANNEL/mantic: 23.10  # Non-LTS
  CHARM_DIR/focal: focal
  CHARM_DIR/jammy: jammy
  CHARM_DIR/mantic: mantic
  # Alma Linux is disabled temporarily: https://github.com/canonical/charmcraft/issues/1496
  #BASE_NAME/alma: almalinux
  #BASE_CHANNEL/alma: 9

include:
  - tests/

prepare: |
  tests.pkgs install unzip

restore: |
  pushd ${CHARM_DIR}
  charmcraft clean
  popd

  rm -rf charm

execute: |
  cd ${CHARM_DIR}
  charmcraft pack --verbose
  test -f *.charm
  unzip -l *.charm | MATCH "venv/ops/charm.py"
  test ! -d build
