###########################################
# IMPORTANT
# Comments matter!
# The docs use the wrapping comments as 
# markers for including said instructions 
# as snippets in the docs.
###########################################
summary: Getting started with Flask tutorial

environment:

execute: |
  # [docs:create-venv]
  sudo apt-get update && sudo apt-get install python3-venv -y
  python3 -m venv .venv
  source .venv/bin/activate
  pip install -r requirements.txt
  # [docs:create-venv-end]

  flask run -p 8000 &
  retry -n 5 --wait 2 curl --fail localhost:8000

  # [docs:curl-flask]
  curl localhost:8000
  # [docs:curl-flask-end]

  kill $!

  # [docs:create-rockcraft-yaml]
  rockcraft init --profile flask-framework
  # [docs:create-rockcraft-yaml-end]
  sed -i "s/name: .*/name: flask-hello-world/g" rockcraft.yaml

  # [docs:pack]
  rockcraft pack
  # [docs:pack-end]

  # [docs:ls-rock]
  ls *.rock -l 
  # [docs:ls-rock-end]

  # [docs:skopeo-copy]
  sudo rockcraft.skopeo --insecure-policy \
    copy oci-archive:flask-hello-world_0.1_amd64.rock \
    docker-daemon:flask-hello-world:0.1
  # [docs:skopeo-copy-end]  
